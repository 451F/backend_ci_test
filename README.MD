# Backend PHP | Full stack dev test task v2

**`Перед тем как приступить,внимательно изучить данный файл!`**
#### Структура

В папке system: находиться ядро нашего CodeIgniter v3 - модифицированный. Некоторая информация находится в папке system/README.MD

В папке application : полный пример приложения - инстаграмма. Main_page - контроллер - класс, где есть готовые Endpoints.

В нем существуют пути-методы: Как инициализировать объект, получать данные, препарировать и отдавать на фронт. Пример класса комментариев, поста, пользователя. После установки вы увидите главную страницу где будет храниться информация которая поможет сделать задание.

Мы работаем всегда с моделями Emerald_model - наши ORM - OOP модели для работы с базой, связями и т.д. Они представляют базу данных, работу с ней. 
Вся логика также хранится в них.


#### Инициализация
###### PHP 
Версии 7.1+ . Проверялось и составлялось на PHP7.3

###### NGinx

nginx/test_task.conf - в nginx conf.d или sites_available
`CI_DOMAIN = указать ваш домен, к примеру sometestworkspace.com`

###### Приложение
Изменить на ваши пути
public/index.php - **$application_folder**

config/database.php - **параметры базы**

###### MySQL

mysql/dump.sql - залить 

_Какие то мелочи могут не работать, например ( php - short_open_tags -> on). Фиксим вручную :)_ 

--------------------------
#### ЗАДАЧИ

`Задачи идут по возрастанию сложности, в нашей оценки, кроме "задачи со звездочкой". Не обязательно все задачи могут быть выполнены, но каждая задача покажет Ваш уровень разработки.`

У нас уже существует в нашем мини-инста список постов и просмотр информации о посте. Но вот не хватает чуть монетизации и юзабилити.

1 - Сделать авторизацию . Login model уже имеет наброски для работы с сессией. Достаточно сделать логин пароль авторизацию в базе данных. 
Для удобства пароль можно не шифровать, чтобы при проверке мы могли легко авторизаоватся. 

`/main_page/login`

2 - Мы можем комментировать только пост. Реализовать возможность оставлять комментарии.

**Задачка "со звездочкой""**

Сделать вложенные комментарии. Их может быть беконченое кол-во вложенностей. 
Любыми способами на основе нашей текущей структуры переделать/улучшить/расширить возможность комментирования любого поста неограниченное колво раз.

`/main_page/comment`

3 - Сделать возможность юзеру лайкать любой комментарий, и любой пост. Неограниченное кол-во раз ( ты можешь не 1 раз лайкнуть пост. А хоть 10 раз, были бы лайки у тебя на балансе) 
  
`/main_page/like`

4 - Сделать монетизацию. Уже есть готовый API-Endpoint по добавлению средств. На вход идет кол-во валюты. У юзера есть в базе есть уже `wallet_balance` которая отвечает за баланс.
`wallet_total_refilled` - сколько человек пополнил за все время и `wallet_total_withdrawn` сколько он потратил (вывел в лайки).
Последние два поля должны считать все действия по счету пользователя сколько он за все время пополнил или потратил. Валюта - USD - $. 

`/main_page/add_money`


5 - Так как в мире самым популярным способом монетизации игр, является покупка "Бустерпаков" - (сундук, ящик, кейс) с предметами\карточками\деньгами - 
предлагаю сделать эту максимально простую возможность для наших пользователей :) 

`/main_page/buy_boosterpack`

Создать 3 бустерпака в которые будут стоить 5$ 20$ и 50$ . В базе структура есть, класс тоже немного уже создан.

Пользователь, покупая данный пак, получает случайное N-ое кол-во лайков, которые может потрать на возможность лайка поста или комментария.
Лайк падает на "лайк-счет" пользователя, где он может их тратить потом. Так сказать, получаем помимо баланса в $ , еще баланс в лайках. 

**Формула:**
```

С учетом собравшегося профитбанка, нужно выбрать ту часть бустерпака, которая доступна для выдачи с учетом цены бустерпака.
Из списка доступных средств рандомно выбрать от 1 до цены бустера + банк и выдать лайки пользователю.
По результату выполнения уменьшит значение профитбанка на сумму (цена бустерпака — цена лайков)

1 Лайк в формуле это 1$.

На примере 1го бустерпака за 5$. 

Пользователь покупает пак за 5$ . Банк 0$.

Формула: итог = рандом( от 1 до цены + банк )  == рандом( 1 до 5$). Если итог 2 лайка , то в банк уходит 5$ - 2 лайка(2$) = 3$

Пользователь покупает пак за 5$ . Банк 3$.

Формула: итог = рандом( от 1 до цены + банк )  == рандом( 1 до 8$). Если итог 4 лайка , то в банк уходит 8$ - 4 лайка(4$) =4$

Пользователь покупает пак за 5$ . Банк 4$.

Формула: итог = рандом( от 1 до цены + банк )  == рандом( 1 до 9$). Если итог 8 лайка , то в банк уходит 9$ - 8 лайков(8$) =1$
```

Таким образом, разница с открытия, которую мы не додали "забрали себе" уходит на следующее открытие следующему юзеру как возможность их выиграть. 
Таким образом мы не уйдем в минус.


6 - Максимальная безопасность. Думаю, тут не нужно обьснять что мы должны записывать все действия с балансом ? :) 
Придумать отличную структуру, для того чтобы мы могли и построить графики, сделать выборки, анализировать действия пользователей в нашей с системе, 
особенно когда работа с балансом.


Приметки: Пока нет.


Результат: работоспособность через HTTP запрос методов.


#### ДОП. ЗАДАЧА Vue.js | Frontend - Fullstack

Сделать чтобы все на фронте функционировало. Задачи относятся к задачам выше по нумерации. Любое решение подобной задачи очень котируется.

1 Авторизация красиво отрабатывала, обновляла страницу после отправки данных.

2 Возможность комментирования любого комментария.

3 Сделать возможность на фронте лайкать любой комментарий ( если сделано вложенные - их тоже)

4 Красивое отображение баланса пользователя в лайках и $, историю движения средств через Api запрос на бекенд в модалке, где будут данные еще сколько в целом пополнил, потратил денег и баланс (дебит, кредит)

5 История открытия бустерпаков, сколько потратил, сколько получил лайков. 

6 Тут ничего не требуется на фронте. Но за изобретательность ( общую историю средств всех пользователей, графики открытия бустерпаков, что угодно - будет огромным плюсом)
 
 
 